<!doctype html><html lang=ja><meta charset=utf-8><meta content=IE=edge http-equiv=X-UA-Compatible><meta content=True name=HandheldFriendly><meta content=width=device-width,initial-scale=1.0 name=viewport><meta name=robots><link href=https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,400;0,700;1,400&family=Source+Sans+Pro:ital,wght@0,300;0,400;0,700;1,400&display=swap rel=stylesheet><link href=/theme/stylesheet/style.min.css rel=stylesheet><link rel="shortcut icon" href=https://yukisakura001.github.io/favicon.ico type=image/vnd.microsoft.icon><link href=https://yukisakura001.github.io/favicon.ico rel=icon><link href=/theme/pygments/monokai.min.css id=pygments-light-theme rel=stylesheet><link href=/theme/font-awesome/css/fontawesome.css rel=stylesheet><link href=/theme/font-awesome/css/brands.css rel=stylesheet><link href=/theme/font-awesome/css/solid.css rel=stylesheet><link rel="shortcut icon" href=favicon.ico type=image/x-icon><link href=favicon.ico rel=icon type=image/x-icon><link title="雪櫻ブログ Atom" href=/feeds/all.atom.xml rel=alternate type=application/atom+xml><meta content=yukisakura name=author><meta content="Pygments ライブラリで画像を出力する際に、日本語フォントを指定する方法を紹介します。" name=description><meta content="プログラミング, 効率化, 初心者向け" name=keywords><meta content=雪櫻ブログ property=og:site_name><meta content="Pygments で日本語フォントの画像を出力する方法" property=og:title><meta content="Pygments ライブラリで画像を出力する際に、日本語フォントを指定する方法を紹介します。" property=og:description><meta content=en_US property=og:locale><meta content=/pygments_japanese_font.html property=og:url><meta content=article property=og:type><meta content="2024-03-28 00:00:00+09:00" property=article:published_time><meta property=article:modified_time><meta content=/author/yukisakura.html property=article:author><meta content=一般 property=article:section><meta content=プログラミング property=article:tag><meta content=効率化 property=article:tag><meta content=初心者向け property=article:tag><meta content=/images/2024-02-18/icon.png property=og:image><title>雪櫻ブログ – Pygments で日本語フォントの画像を出力する方法</title><meta content=website property=og:type><meta content=雪櫻ブログ property=og:site_name><meta content="雪櫻ブログ | Pygments で日本語フォントの画像を出力する方法" property=og:title><meta content=https://yukisakura001.github.io//pygments_japanese_font.html property=og:url><meta content=https://yukisakura001.github.io/images/2024-03-28/pygments_japanese_font/icat.png property=og:image><body class=light-theme><aside><div><a href=/> <img alt=雪櫻のブログ src=/images/2024-02-18/icon.png title=雪櫻のブログ> </a><h1><a href=/>雪櫻のブログ</a></h1><p>雑多なブログ帳~♪<nav><ul class=list><li><a href=/pages/konoburogunitsuite.html> このブログについて </a></ul></nav><ul class=social><li><a class=sc-github href=https://github.com/yukisakura001 target=_blank> <i class="fa-brands fa-github"></i> </a><li><a class=sc-youtube href=https://www.youtube.com/@yukisakura_pc target=_blank> <i class="fa-brands fa-youtube"></i> </a><li><a class=sc-twitter href=https://twitter.com/yukisakura001 target=_blank> <i class="fa-brands fa-twitter"></i> </a><li><a class=sc-rss href=feeds/all.atom.xml target=_blank> <i class="fa-solid fa-rss"></i> </a></ul></div></aside><main><nav><a href=/>Home</a><a href=/archives.html>記事履歴</a><a href=/categories.html>カテゴリー</a><a href=/tags.html>タグ一覧</a><a href=/feeds/all.atom.xml>Atom</a></nav><article class=single><header><h1 id=pygments_japanese_font>Pygments で日本語フォントの画像を出力する方法</h1><p>Posted on 2024年03月28日 (木) in <a href=/category/yi-ban.html>一般</a></header><div><p><img alt=アイキャッチ src=/images/2024-03-28/pygments_japanese_font/icat.png><h1 id=_1><font color=#ff5a09>目次</font></h1><div class=toc><ul><li><a href=#_1 rel=nofollow>目次</a><li><a href=#_2 rel=nofollow>はじめに</a><li><a href=#_3 rel=nofollow>日本語出力方法</a><li><a href=#_4 rel=nofollow>終わりに</a></ul></div><h1 id=_2><font color=#ff5a09>はじめに</font></h1><p>Pygments は、様々な言語のソースコードを解析し、色を付けて出力することなどができる Python ライブラリです。<p>出力方法としては、一般的に HTML が使用されますが、Pillow を使用することで画像としても出力することができます。<p>画像として出力する際のコードの一例です。<div class=highlight><pre><span></span><code><span class=kn>from</span> <span class=nn>pygments</span> <span class=kn>import</span> <span class=n>highlight</span>
<span class=kn>from</span> <span class=nn>pygments.lexers</span> <span class=kn>import</span> <span class=n>get_lexer_by_name</span>
<span class=kn>from</span> <span class=nn>pygments.formatters</span> <span class=kn>import</span> <span class=n>ImageFormatter</span>

<span class=n>code</span><span class=o>=</span><span class=s2>"""</span>
<span class=s2>print("Hello World")</span>
<span class=s2>"""</span>
<span class=n>path</span><span class=o>=</span><span class=s2>"output.png"</span>
<span class=n>lexer</span> <span class=o>=</span> <span class=n>get_lexer_by_name</span><span class=p>(</span><span class=s2>"python"</span><span class=p>)</span>
<span class=n>formatter</span> <span class=o>=</span> <span class=n>ImageFormatter</span><span class=p>(</span><span class=n>style</span><span class=o>=</span><span class=s2>"default"</span><span class=p>)</span>
<span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>path</span><span class=p>,</span> <span class=s1>'wb'</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
    <span class=n>highlight</span><span class=p>(</span><span class=n>code</span><span class=p>,</span> <span class=n>lexer</span><span class=p>,</span> <span class=n>formatter</span><span class=p>,</span> <span class=n>outfile</span><span class=o>=</span><span class=n>f</span><span class=p>)</span>
</code></pre></div><p>基本的にこの簡単なコードで画像を出力することができるのですが、一つ問題があります。<p>それはコードの中に日本語が入っていると、□ に文字化けしてしまうということです。<p>今回はその解決策を書いていきます。<h1 id=_3><font color=#ff5a09>日本語出力方法</font></h1><p>このように日本語が文字化けする原因は、この手の問題でよくあるフォントが日本語に対応していないからです。<p>日本語に対応させるためには、<code>ImageFormatter</code>のなかにある引数の<code>font_size</code>で日本語等幅フォントを指定すれば解決できます。<p>しかしここに「BIZ UD ゴシック」や「BIZ-UDGothicB」など名前そのままで指定しても、認識されずにエラーを吐いてしまします。<p>この<code>font_name</code>の引数でフォント名を指定するには、レジストリに登録されている名前で入力する必要があるのです。<p>そのためまずはレジストリからフォント名を確認する必要があります。<p>「Win+R」で出てくる「ファイル名を指定して実行」に「regedit」を入力するとレジストリエディタが開き、<br> そこから「コンピューター\HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Fonts」<br> を開いていくとフォント一覧が出てきます。<p>その中にあるフォント名が<code>font_name</code>で使えるフォント名となります。<p>例：BIZ UDGothic & BIZ UDPGothic (TrueType);<p>なので先程のコードに加えると、<div class=highlight><pre><span></span><code><span class=err>```</span><span class=n>python</span>
<span class=kn>from</span> <span class=nn>pygments</span> <span class=kn>import</span> <span class=n>highlight</span>
<span class=kn>from</span> <span class=nn>pygments.lexers</span> <span class=kn>import</span> <span class=n>get_lexer_by_name</span>
<span class=kn>from</span> <span class=nn>pygments.formatters</span> <span class=kn>import</span> <span class=n>ImageFormatter</span>

<span class=n>code</span><span class=o>=</span><span class=s2>"""</span>
<span class=s2>print("Hello World")</span>
<span class=s2>"""</span>
<span class=n>path</span><span class=o>=</span><span class=s2>"output.png"</span>
<span class=n>lexer</span> <span class=o>=</span> <span class=n>get_lexer_by_name</span><span class=p>(</span><span class=s2>"python"</span><span class=p>)</span>
<span class=n>formatter</span> <span class=o>=</span> <span class=n>ImageFormatter</span><span class=p>(</span><span class=n>style</span><span class=o>=</span><span class=s2>"default"</span><span class=p>,</span>
                          <span class=n>font_name</span><span class=o>=</span><span class=s2>"BIZ UDGothic & BIZ UDPGothic (TrueType);"</span><span class=p>)</span>
<span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>path</span><span class=p>,</span> <span class=s1>'wb'</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
    <span class=n>highlight</span><span class=p>(</span><span class=n>code</span><span class=p>,</span> <span class=n>lexer</span><span class=p>,</span> <span class=n>formatter</span><span class=p>,</span> <span class=n>outfile</span><span class=o>=</span><span class=n>f</span><span class=p>)</span>
</code></pre></div><p>となります。<p>このような方法で、他のフォントを使うことができます。<h1 id=_4><font color=#ff5a09>終わりに</font></h1><p>今回のやり方は Yukis Army knife に「コード画像化」を追加する際に少し手こずった時に見つけたものです。<p>Pygments はコードの画像化以外にも、コードを入力・出力するタイプのソフトやアプリの開発にも使えそうなので、このライブラリを覚えておくと便利だと思います。<p>（見落としがなければ）公式ドキュメントにも詳しい解説が無くフォント名を指定するとしか書いてなかったので、今回の記事が誰かの役に立つと嬉しいです。</div><div class=tag-cloud><p><a href=/tag/puroguramingu.html>プログラミング</a> <a href=/tag/xiao-lu-hua.html>効率化</a> <a href=/tag/chu-xin-zhe-xiang-ke.html>初心者向け</a></div><div class=neighbors><a class="btn float-left" title="Yukis Army knife ver6.6 公開" href=/yak_update6_6.html> <i class="fa fa-angle-left"></i> Previous Post </a><a class="btn float-right" title="GitHub Release でのダウンロード数を Python から取得する方法" href=/github_release_file_download.html> Next Post <i class="fa fa-angle-right"></i> </a></div><div class=related-posts><h4>You might enjoy</h4><ul class=related-posts><li><a href=/web_front_intro1.html>初めての web アプリ勉強のすゝめ ~フロント編 ①~</a><li><a href=/github_release_file_download.html>GitHub Release でのダウンロード数を Python から取得する方法</a><li><a href=/yak_update7_1.html>Yukis Army knife ver7.1 公開</a><li><a href=/typescript_tool_kazyougaki.html>HTML+css+TypeScript で構造化した箇条書きに適切な見出しをつけるツールを作ってみた</a><li><a href=/yak_update7_0.html>Yukis Army knife ver7.0 公開</a></ul></div></article><footer><p>© 2024 雪櫻<p>Built with <a href=http://getpelican.com target=_blank>Pelican</a> using <a href=http://bit.ly/flex-pelican target=_blank>Flex</a> theme</footer></main><script type=application/ld+json>
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " 雪櫻ブログ ",
  "url" : "",
  "image": "/images/2024-02-18/icon.png",
  "description": ""
}
</script>