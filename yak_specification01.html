<!doctype html><html lang=ja><meta charset=utf-8><meta content=IE=edge http-equiv=X-UA-Compatible><meta content=True name=HandheldFriendly><meta content=width=device-width,initial-scale=1.0 name=viewport><meta name=robots><link href=https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,400;0,700;1,400&family=Source+Sans+Pro:ital,wght@0,300;0,400;0,700;1,400&display=swap rel=stylesheet><link href=/theme/stylesheet/style.min.css rel=stylesheet><link rel="shortcut icon" href=https://yukisakura001.github.io/favicon.ico type=image/vnd.microsoft.icon><link href=https://yukisakura001.github.io/favicon.ico rel=icon><link href=/theme/pygments/monokai.min.css id=pygments-light-theme rel=stylesheet><link href=/theme/font-awesome/css/fontawesome.css rel=stylesheet><link href=/theme/font-awesome/css/brands.css rel=stylesheet><link href=/theme/font-awesome/css/solid.css rel=stylesheet><link rel="shortcut icon" href=favicon.ico type=image/x-icon><link href=favicon.ico rel=icon type=image/x-icon><link title="雪櫻ブログ Atom" href=/feeds/all.atom.xml rel=alternate type=application/atom+xml><meta content=yukisakura name=author><meta content="Yukis Army knife の仕様の一つである「タスク常駐機能」の実装した経緯について書いた備忘録です" name=description><meta content="プログラミング, 自作ツール, 備忘録" name=keywords><meta content=雪櫻ブログ property=og:site_name><meta content="Yukis Army knife の工夫・仕様の備忘録（タスクトレイ常駐機能編）" property=og:title><meta content="Yukis Army knife の仕様の一つである「タスク常駐機能」の実装した経緯について書いた備忘録です" property=og:description><meta content=en_US property=og:locale><meta content=/yak_specification01.html property=og:url><meta content=article property=og:type><meta content="2024-03-02 00:00:00+09:00" property=article:published_time><meta property=article:modified_time><meta content=/author/yukisakura.html property=article:author><meta content=自作ツール property=article:section><meta content=プログラミング property=article:tag><meta content=自作ツール property=article:tag><meta content=備忘録 property=article:tag><meta content=/images/2024-02-18/icon.png property=og:image><title>雪櫻ブログ – Yukis Army knife の工夫・仕様の備忘録（タスクトレイ常駐機能編）</title><meta content=website property=og:type><meta content=雪櫻ブログ property=og:site_name><meta content="雪櫻ブログ | Yukis Army knife の工夫・仕様の備忘録（タスクトレイ常駐機能編）" property=og:title><meta content=https://yukisakura001.github.io//yak_specification01.html property=og:url><meta content=https://yukisakura001.github.io/images/2024-03-02/yak_specification01/icat.png property=og:image><body class=light-theme><aside><div><a href=/> <img alt=雪櫻のブログ src=/images/2024-02-18/icon.png title=雪櫻のブログ> </a><h1><a href=/>雪櫻のブログ</a></h1><p>雑多なブログ帳~♪<nav><ul class=list><li><a href=/pages/konoburogunitsuite.html> このブログについて </a></ul></nav><ul class=social><li><a class=sc-github href=https://github.com/yukisakura001 target=_blank> <i class="fa-brands fa-github"></i> </a><li><a class=sc-youtube href=https://www.youtube.com/@yukisakura_pc target=_blank> <i class="fa-brands fa-youtube"></i> </a><li><a class=sc-twitter href=https://twitter.com/yukisakura001 target=_blank> <i class="fa-brands fa-twitter"></i> </a><li><a class=sc-rss href=feeds/all.atom.xml target=_blank> <i class="fa-solid fa-rss"></i> </a></ul></div></aside><main><nav><a href=/>Home</a><a href=/archives.html>記事履歴</a><a href=/categories.html>カテゴリー</a><a href=/tags.html>タグ一覧</a><a href=/feeds/all.atom.xml>Atom</a></nav><article class=single><header><h1 id=yak_specification01>Yukis Army knife の工夫・仕様の備忘録（タスクトレイ常駐機能編）</h1><p>Posted on 2024年03月02日 (土) in <a href=/category/zi-zuo-tsu-ru.html>自作ツール</a></header><div><p><img alt=アイキャッチ src=/images/2024-03-02/yak_specification01/icat.png><h1 id=_1><font color=#ff5a09>目次</font></h1><div class=toc><ul><li><a href=#_1 rel=nofollow>目次</a><li><a href=#_2 rel=nofollow>はじめに</a><li><a href=#_3 rel=nofollow>タスクトレイ起動を実装した理由</a><li><a href=#_4 rel=nofollow>苦労した点</a><li><a href=#_5 rel=nofollow>常時起動したことによる恩恵</a><li><a href=#_6 rel=nofollow>終わりに</a></ul></div><h1 id=_2><font color=#ff5a09>はじめに</font></h1><p>Yukis Army knife は多くの便利ツールを使用できる万能？ソフトです。<p>Yukis Army knife は当初自分用の文字数カウントソフトとして作り始めましたが、徐々にほしいと思う機能を増設した結果今のようなソフトの形になりました。<p>しかしアプデの際、機能を増設するだけでなく全体の使いやすさも考えて、試行錯誤しながら様々な試みを試していました。<p>今回はそのような試みの中で生まれた仕様の一つである、「タスクトレイ常駐」について備忘録も兼ねて書こうと思います。<h1 id=_3><font color=#ff5a09>タスクトレイ起動を実装した理由</font></h1><p>Yukis Army knife は exe ファイルを実行してもすぐにウィンドウが表示されず、タスクトレイにアイコンが表示され、アイコンをクリックすることでウィンドウが表示されます（今はショートカットでも起動できます）。<p>またウィンドウを消してもタスクトレイに常駐し、完全に停止しません。<p>こんな仕様を始めた理由は、起動速度の遅さをごまかすためです。<p>当初は起動後すぐにウィンドウが表示・閉じるとソフトを停止するようになっていましたが、機能が増えるにつれ起動が明らかに遅くなり、使い勝手が非常に悪くなっていました。<p>このソフトは必要な時だけ起動しそれ以外の時は閉じる場面が多いため、この起動速度の遅さは深刻な問題です。<p>これを解決するするために、<ul><li><p>ソフトを最適化</p><li><p>ビルドツールの変更（Pyinstaller から Nuitka などへ）</p></ul><p>という解決策を慣れないなりに考えました。<p>しかし「ソフト最適化」は仕様的にどう考えても難しく、「ビルドツール変更」は Nuitka のビルド速度が遅すぎて試行錯誤が困難だったため諦めました。<p>また今後もどんどん機能を増やす予定だったため、これらの対策は上手く行っても一時しのぎにしかならないことは分かっていました。<p>「タスクトレイ常駐」はこれらの対策を諦めた頃に、ちょうど Pystray というタスクトレイにアイコンを置けるライブラリを見つけたことで思いついた案です。<p>裏で常時起動しておけば起動の遅さは最初だけで済み、必要なとき即座にウィンドウを表示することができます。<p>この対策は結果的に成功し、軽快にウィンドウ表示ができるようになりました。<h1 id=_4><font color=#ff5a09>苦労した点</font></h1><p>常時起動の実装自体は思ったより簡単にできたですが、「アイコンを左クリックした際の処理」が Pystray の公式ドキュメントに書いてなかったため、ここの実装に苦慮しました。<p>「アイコンを右クリックした後に、メニューのウィンドウ表示をクリック」という二段階だとパッと開くイメージに沿わず、どうしても拘りたかったため自分で実装し直すことにしましたが、修正ができないバグがあまりに多すぎて頓挫しました。<p>ここで一回常時起動の夢は諦めかけたのですが、StackOverflow で調べていた時たまたまアイコン左クリック時の動作に関するページを見つけたおかげで、なんとか実装がすることができました。<p><a href=https://stackoverflow.com/questions/69990684/with-python-pystray-how-to-maximize-a-window-from-the-system-tray-icon-by-click rel=nofollow>そのページ</a><h1 id=_5><font color=#ff5a09>常時起動したことによる恩恵</font></h1><p>元々ウィンドウ表示の高速化のために常時起動にしたのですが、この仕様に変更した恩恵は他にもたくさんありました。<ul><li><p>アイコン右クリック時のメニューに、お気に入りの機能を登録できる機能を実装できた</p><li><p>ショートカット起動の実装が可能に</p><li><p>別ウィンドウ表示系の機能の使い勝手向上</p></ul><p>特に最初の「アイコン右クリックメニューにお気に入り登録」が可能になったことは、このソフトの別の欠点である「機能が多すぎて使いたい機能を選択するのが困難」問題への一つの答えとなりました。<h1 id=_6><font color=#ff5a09>終わりに</font></h1><p>タスクトレイに常駐する仕様になったのはこのような経緯がありました。<p>ただこのような動作は比較的珍しい（気がする）ため、パソコンに慣れていない人は初見で理解が難しく、解説を読まずに導入した友人から「起動に失敗する」と言われてしまいました。<p>世の中にはドキュメントを見る前に弄るタイプの人間が多い（自分もそう）ため、ソフト起動時に分かりやすく知らせる機能も必要なのかなと反省し、改善を考えています。<p>今回の記事は割と独り言でしたが、ここまで読んでいただきありがとうございます。</div><div class=tag-cloud><p><a href=/tag/puroguramingu.html>プログラミング</a> <a href=/tag/zi-zuo-tsu-ru.html>自作ツール</a> <a href=/tag/bei-wang-lu.html>備忘録</a></div><div class=neighbors><a class="btn float-left" href=/blog_tools01.html title=ブログを書くときに便利なツール> <i class="fa fa-angle-left"></i> Previous Post </a><a class="btn float-right" title="プログラミング初心者向け、Python の活用のすゝめ" href=/python_tool_make.html> Next Post <i class="fa fa-angle-right"></i> </a></div><div class=related-posts><h4>You might enjoy</h4><ul class=related-posts><li><a href=/emoji_mytool.html>自作した絵文字検索ツール（仮）の埋葬</a><li><a href=/python_flet_appfirst.html>Flet で GitHub Release のダウンロード数を取得するアプリを作ってみた</a><li><a href=/yak_update6_6.html>Yukis Army knife ver6.6 公開</a><li><a href=/yak_update6_5.html>Yukis Army knife ver6.5 公開</a><li><a href=/yak_update6_4.html>Yukis Army knife ver6.4 公開</a></ul></div></article><footer><p>© 2024 雪櫻<p>Built with <a href=http://getpelican.com target=_blank>Pelican</a> using <a href=http://bit.ly/flex-pelican target=_blank>Flex</a> theme</footer></main><script type=application/ld+json>
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " 雪櫻ブログ ",
  "url" : "",
  "image": "/images/2024-02-18/icon.png",
  "description": ""
}
</script>